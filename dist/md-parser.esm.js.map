{"version":3,"file":"md-parser.esm.js","sources":["../src/Token.ts","../src/markup/Image.ts","../src/TokenReader.ts","../src/BaseParser.ts","../src/markup/Paragraph.ts","../src/markup/Header.ts","../src/markup/Text.ts","../src/markup/BlockMarkableItem.ts","../src/markup/Strikeout.ts","../src/markup/Strong.ts","../src/markup/Emphasis.ts","../src/markup/Code.ts","../src/MdParser.ts"],"sourcesContent":["export enum Token {\n  END,\n  EMPHASIS,\n  STRONG,\n  STRIKEOUT,\n  CODE,\n  TEXT,\n  _EMPHASIS,\n  __STRONG,\n  IMG\n}\n","import {BlockItem} from './BlockItem';\n\nexport class Image implements BlockItem {\n  private readonly name: string;\n  private readonly src: string;\n\n  constructor(name: string, src: string) {\n    this.name = name;\n    this.src = src;\n  }\n\n  toHtml(st: Array<string>): void {\n    st.push('<img alt=\\'');\n    st.push(this.name);\n    st.push('\\' src=\\'');\n    st.push(this.src);\n    st.push('\\'>');\n  }\n\n  toMarkdown(st: Array<string>): void {\n    throw st;\n  }\n\n\n}\n","import { Token } from './Token';\nimport { Image } from './markup/Image';\n\nexport class TokenReader {\n  private readonly source: string = '';\n\n  private pos: number = 0;\n\n  private curToken: Token = Token.CODE;\n\n  private curStringToken: string = '';\n\n  private tags: string[] = ['**', '__', '--', '*', '_', '`'];\n\n  private imgName: string = '';\n\n  private imgSrc: string = '';\n\n  private strToToken = new Map([\n    ['**', Token.STRONG],\n    ['*', Token.EMPHASIS],\n    ['--', Token.STRIKEOUT],\n    ['`', Token.CODE],\n    ['_', Token._EMPHASIS],\n    ['__', Token.__STRONG],\n    ['![', Token.IMG],\n  ]);\n\n  private curTag: string = '';\n\n  constructor(source: string, isImageRequired?: boolean) {\n    if (isImageRequired) {\n      this.tags.push('![');\n    }\n    this.source = source;\n    this.pos = 0;\n  }\n\n  private checkTag(): boolean {\n    for (const tag of this.tags) {\n      if (this.source.startsWith(tag, this.pos)) {\n        this.curTag = tag;\n        return true;\n      }\n    }\n    return false;\n  }\n\n  private test(ch: string): boolean {\n    return this.pos < this.source.length && ch === this.source[this.pos];\n  }\n\n  private parseImg(): void {\n    const start: number = this.pos;\n    let mid: number;\n    let end: number;\n    while (this.pos < this.source.length &&\n          !this.source.startsWith('](', this.pos)) {\n      this.pos++;\n    }\n    if (this.pos < this.source.length && this.source.startsWith('](', this.pos)) {\n      mid = this.pos;\n      while (this.pos < this.source.length && !this.source.startsWith(')', this.pos)) {\n        this.pos++;\n      }\n      if (this.pos < this.source.length && this.source.startsWith(')', this.pos)) {\n        end = this.pos;\n        this.imgName = this.source.substring(start, mid);\n        this.imgSrc = this.source.substring(mid + 2, end);\n        this.pos++;\n        return;\n      }\n    }\n    throw 'atata';\n  }\n\n  public getImg(): Image {\n    return new Image(this.imgName, this.imgSrc);\n  }\n\n  public nextToken(): Token {\n    if (this.pos >= this.source.length) {\n      return Token.END;\n    }\n\n    if (this.checkTag()) {\n      this.curStringToken = this.curTag;\n      const temp = this.strToToken.get(this.curTag);\n      this.curToken = temp === undefined ? Token.CODE : temp;\n      this.pos += this.curTag.length;\n      if (this.curToken === Token.IMG) {\n        this.parseImg();\n      }\n      return this.curToken;\n    }\n\n    const sb: Array<string> = new Array<string>();\n\n    while (this.pos < this.source.length && !this.checkTag()) {\n      const ch: string = this.source.charAt(this.pos++);\n      if (ch === '<') {\n        sb.push('&lt;');\n      } else if (ch === '>') {\n        sb.push('&gt;');\n      } else if (ch === '&') {\n        sb.push('&amp;');\n      } else if (ch === '\\\\' && this.pos < this.source.length && (this.test('*') || this.test('_'))) {\n        sb.push(this.source.charAt(this.pos++));\n      } else {\n        sb.push(ch);\n      }\n    }\n\n    this.curToken = Token.TEXT;\n\n    this.curStringToken = sb.join('');\n\n    return this.curToken;\n  }\n\n\n  public getStringToken(): string {\n    return this.curStringToken;\n  }\n}\n","import { TokenReader } from './TokenReader';\nimport { Token } from './Token';\n\nexport abstract class BaseParser {\n  protected tr: TokenReader;\n  protected curToken: Token;\n  protected curStringToken: string;\n\n  protected nextToken(): void {\n    this.curToken = this.tr.nextToken();\n    this.curStringToken = this.tr.getStringToken();\n  }\n\n  protected constructor() {\n    this.tr = new TokenReader('');\n    this.curToken = Token.CODE;\n    this.curStringToken = '';\n  }\n}\n","import {Markable} from './Markable';\nimport {BlockItem} from './BlockItem';\n\nexport class Paragraph implements Markable {\n  private readonly elements: Array<BlockItem>;\n\n  constructor(elements: Array<BlockItem>) {\n    this.elements = new Array<BlockItem>(...elements);\n  }\n\n  toHtml(st: Array<string>): void {\n    st.push('<p>');\n    for (const elem of this.elements) {\n      elem.toHtml(st);\n    }\n    st.push('</p>');\n  }\n\n  toMarkdown(st: Array<string>): void {\n    for (const elem of this.elements) {\n      elem.toMarkdown(st);\n    }\n  }\n\n\n}\n","import {Markable} from './Markable';\nimport {BlockItem} from './BlockItem';\n\nexport class Header implements Markable {\n\n  private elements: Array<BlockItem>;\n  private hLevel: number;\n\n  constructor(elements: Array<BlockItem>, hLevel: number) {\n    this.hLevel = hLevel;\n    this.elements = new Array<BlockItem>(...elements);\n  }\n\n  toHtml(st: Array<string>): void {\n    st.push(`<h${this.hLevel}>`);\n    for (const elem of this.elements) {\n      elem.toHtml(st);\n    }\n    st.push(`</h${this.hLevel}>`);\n  }\n\n  toMarkdown(st: Array<string>): void {\n    throw st;\n  }\n\n}\n","import {BlockItem} from './BlockItem';\n\nexport class Text implements BlockItem {\n  private text: string;\n\n  constructor(text: string) {\n    this.text = text;\n  }\n\n  toHtml(st: Array<string>): void {\n    st.push(this.text);\n  }\n\n  toMarkdown(st: Array<string>): void {\n    st.push(this.text);\n  }\n\n\n}\n","import {BlockItem} from './BlockItem';\n\nexport abstract class BlockMarkableItem implements BlockItem {\n  private elements: Array<BlockItem>;\n\n  protected constructor(elements: Array<BlockItem>) {\n    this.elements = new Array<BlockItem>(...elements);\n  }\n\n  protected toMarkdownSuper(start: string, end: string, st: Array<string>): void {\n    st.push(start);\n    for (const elem of this.elements) {\n      elem.toMarkdown(st);\n    }\n    st.push(end);\n  }\n\n  protected toHtmlSuper(start: string, end: string, st: Array<string>): void {\n    st.push(start);\n    for (const elem of this.elements) {\n      elem.toMarkdown(st);\n    }\n    st.push(end);\n  }\n\n  abstract toMarkdown(st: Array<string>): void;\n\n  abstract toHtml(st: Array<string>): void;\n}\n","import {BlockMarkableItem} from './BlockMarkableItem';\nimport {BlockItem} from './BlockItem';\n\nexport class Strikeout extends BlockMarkableItem {\n  constructor(elements: Array<BlockItem>) {\n    super(elements);\n  }\n\n  toHtml(st: Array<string>): void {\n    super.toHtmlSuper('<s>', '</s>', st);\n  }\n\n  toMarkdown(st: Array<string>): void {\n    super.toMarkdownSuper('~', '~', st);\n  }\n}\n","import {BlockMarkableItem} from './BlockMarkableItem';\nimport {BlockItem} from './BlockItem';\n\nexport class Strong extends BlockMarkableItem {\n  constructor(elements: Array<BlockItem>) {\n    super(elements);\n  }\n\n  toHtml(st: Array<string>): void {\n    super.toHtmlSuper('<strong>', '</strong>', st);\n  }\n\n  toMarkdown(st: Array<string>): void {\n    super.toMarkdownSuper('__', '__', st);\n  }\n}\n","import {BlockItem} from './BlockItem';\nimport {BlockMarkableItem} from './BlockMarkableItem';\n\nexport class Emphasis extends BlockMarkableItem {\n\n  constructor(elements: Array<BlockItem>) {\n    super(elements);\n  }\n\n  toHtml(st: Array<string>): void {\n    super.toHtmlSuper('<em>', '</em>', st);\n  }\n\n  toMarkdown(st: Array<string>): void {\n    super.toMarkdownSuper('*', '*', st);\n  }\n}\n","import {BlockMarkableItem} from './BlockMarkableItem';\nimport {BlockItem} from './BlockItem';\n\nexport class Code extends BlockMarkableItem {\n\n  constructor(elements: Array<BlockItem>) {\n    super(elements);\n  }\n\n  toHtml(st: Array<string>): void {\n    super.toHtmlSuper('`', '`', st);\n  }\n\n  toMarkdown(st: Array<string>): void {\n    super.toMarkdownSuper('<code>', '</code>', st);\n  }\n}\n","import { BaseParser } from './BaseParser';\nimport { Markable } from './markup/Markable';\nimport { TokenReader } from './TokenReader';\nimport { Paragraph } from './markup/Paragraph';\nimport { Header } from './markup/Header';\nimport { Token } from './Token';\nimport { BlockItem } from './markup/BlockItem';\nimport { Text } from './markup/Text';\nimport { Strikeout } from './markup/Strikeout';\nimport { Strong } from './markup/Strong';\nimport { Emphasis } from './markup/Emphasis';\nimport { Code } from './markup/Code';\n\n\nexport class MdParser extends BaseParser {\n  private readonly source: Array<string>;\n  private curElem: string = '';\n  private curLine: string | null = '';\n  private headerStarts = ['###### ', '##### ', '#### ', '### ', '## ', '# '];\n\n  private hLevel: number = 0;\n\n  isHeaderRequired: boolean = false;\n  isImageRequired: boolean = false;\n\n  constructor(data: string, isHeaderRequired?: boolean, isImageRequired?: boolean) {\n    super();\n    this.isImageRequired = !!isImageRequired;\n    this.isHeaderRequired = !!isHeaderRequired;\n    this.source = data.split('\\n');\n  }\n\n\n  public parse(): Array<Markable> {\n    const ans = new Array<Markable>();\n    while (this.nextElement()) {\n      if (this.isParagraph()) {\n        this.tr = new TokenReader(this.curElem, this.isImageRequired);\n        this.nextToken();\n        ans.push(new Paragraph(this.parseItems()));\n      } else {\n        this.tr = new TokenReader(this.curElem.substring(this.hLevel + 1), this.isImageRequired);\n        this.nextToken();\n        ans.push(new Header(this.parseItems(), this.hLevel));\n      }\n    }\n    return ans;\n  }\n\n  private isText(token: Token) {\n    return token === Token.TEXT;\n  }\n\n  private parseItems(): Array<BlockItem> {\n    const ans = new Array<BlockItem>();\n    while (this.curToken !== Token.END) {\n      if (this.isText(this.curToken)) {\n        ans.push(new Text(this.curStringToken));\n        this.nextToken();\n      } else if (this.curToken === Token.IMG) {\n        ans.push(this.tr.getImg());\n        this.nextToken();\n      } else {\n        const start: Token = this.curToken;\n        this.nextToken();\n        ans.push(...this.parseItem(start));\n      }\n    }\n    return ans;\n  }\n\n  private parseItem(start: Token): Array<BlockItem> {\n    const ans = new Array<BlockItem>();\n    while (this.curToken !== Token.END && this.curToken !== start) {\n      if (this.isText(this.curToken)) {\n        ans.push(new Text(this.curStringToken));\n        this.nextToken();\n      } else if (this.curToken === Token.IMG) {\n        ans.push(this.tr.getImg());\n        this.nextToken();\n      } else {\n        const st: Token = this.curToken;\n        this.nextToken();\n        ans.push(...this.parseItem(st));\n      }\n    }\n    if (this.curToken === start) {\n      this.nextToken();\n      return this.create(ans, start);\n    } else if (start === Token.EMPHASIS || start === Token._EMPHASIS) {\n      const temp = new Array<BlockItem>();\n      temp.push(new Text(this.tokenToString(start)));\n      temp.push(...ans);\n      this.nextToken();\n      return temp;\n    } else {\n      throw 'Unclosed tag! expected ' + start + 'found ' + this.curToken;\n    }\n  }\n\n  private tokenToString(token: Token): string {\n    switch (token) {\n      case Token.STRIKEOUT: {\n        return '--';\n      }\n      case Token.STRONG: {\n        return '**';\n      }\n      case Token.__STRONG: {\n        return '__';\n      }\n      case Token.EMPHASIS: {\n        return '*';\n      }\n      case Token._EMPHASIS: {\n        return '_';\n      }\n      case Token.CODE: {\n        return '`';\n      }\n      default: {\n        throw 'atata';\n      }\n    }\n  }\n\n  private create(ans: Array<BlockItem>, token: Token): Array<BlockItem> {\n    switch (token) {\n      case Token.STRIKEOUT: {\n        return [new Strikeout(ans)];\n      }\n      case Token.STRONG: {\n        return [new Strong(ans)];\n      }\n      case Token.__STRONG: {\n        return [new Strong(ans)];\n      }\n      case Token.EMPHASIS: {\n        return [new Emphasis(ans)];\n      }\n      case Token._EMPHASIS: {\n        return [new Emphasis(ans)];\n      }\n      case Token.CODE: {\n        return [new Code(ans)];\n      }\n      default: {\n        throw 'atata';\n      }\n    }\n  }\n\n  private skipEmpties(): void {\n    this.curLine = this.next();\n    while (this.curLine !== null && this.curLine === '') {\n      this.curLine = this.next();\n    }\n  }\n\n  private nextElement(): boolean {\n    this.skipEmpties();\n    if (this.curLine === null) {\n      return false;\n    }\n    const elem = new Array<string>();\n    elem.push(this.curLine);\n    this.curLine = this.next();\n    while (this.curLine !== null && this.curLine !== '') {\n      elem.push('\\n');\n      elem.push(this.curLine);\n      this.curLine = this.next();\n    }\n    this.curElem = elem.join('');\n    return true;\n  }\n\n  next(): string | null {\n    const exp = this.source.length === 0 ? null : this.source.shift();\n    if (exp !== undefined) {\n      return exp;\n    }\n    return null;\n  }\n\n  private isParagraph(): boolean {\n    if (this.isHeaderRequired) {\n      for (const headerStart of this.headerStarts) {\n        if (this.curElem.startsWith(headerStart)) {\n          this.hLevel = headerStart.length - 1;\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n}\n"],"names":["Token","Image","name","src","toHtml","st","push","toMarkdown","TokenReader","source","isImageRequired","CODE","Map","STRONG","EMPHASIS","STRIKEOUT","_EMPHASIS","__STRONG","IMG","tags","pos","checkTag","tag","startsWith","curTag","test","ch","length","parseImg","start","mid","end","imgName","substring","imgSrc","getImg","nextToken","END","curStringToken","temp","strToToken","get","curToken","undefined","sb","Array","charAt","TEXT","join","getStringToken","BaseParser","tr","Paragraph","elements","elem","Header","hLevel","Text","text","BlockMarkableItem","toMarkdownSuper","toHtmlSuper","Strikeout","Strong","Emphasis","Code","MdParser","data","isHeaderRequired","split","parse","ans","nextElement","isParagraph","curElem","parseItems","isText","token","parseItem","create","tokenToString","skipEmpties","curLine","next","exp","shift","headerStarts","headerStart"],"mappings":"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"}